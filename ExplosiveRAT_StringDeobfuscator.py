'''
Author: KrknSec
Description: This is a basic string deobfuscator script for the Explosive RAT by the Lebanese Cedar APT group.
Guide: First dump all strings to a file. Then run this script on the newly created .txt file containing the strings. This script will translate all 
"Exploiter" strings into what they are.
Todo: Currently working on a script where you just need to specify the binary instead of dumping strings first.
'''

import string
import sys
import re
from typing import Pattern
import base64

pattern = r'Exploiter'

f = open(sys.argv[1], 'r').readlines()
print("\n[+]-----------------------------[+]")
print("EXPLOSIVE RAT STRING DEOBFUSCATOR")
print("[+]-----------------------------[+]\n")
for line in f:
  
  # Remove null bytes because strings are stored in Unicode in the binary
  new_line = re.sub(r'[\x00]', "", line)
  
  # Search for the Exploiter tag
  match = re.search(pattern, new_line)
  
  if match:
    
    # Remove the Exploiter tag
    reversed_base64 = re.sub(pattern, "", new_line)
    
    # Reverse the Base64
    rev = reversed_base64[::-1]
    
    # Decode the Base64
    decoded = base64.b64decode(rev + '==')
    decodedStr = str(decoded, "utf-8", errors='ignore')
    
    # Reverse the readable string and print
    revAgain = decodedStr[::-1]
    print("\nOriginal: " + new_line)
    print("Deobfuscated: "+ revAgain + "\n")
    print("-------------------------------------------------")
    print("-------------------------------------------------")
